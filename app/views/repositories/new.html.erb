<% provide(:title, "New Project") %>
<section id="new-repo">
  <div class="title">New Project<br>Nouveau Projet</div>

  <%= form_for @repository, url: {controller: "repositories", action: "create"}, html: {multipart: true} do |f| %>
    <br>
    <div class="form-group">
    <%= f.label :title, "*Title/Titre" %>
    <div>Great project titles are short and memorable.<br>Des titres de projets génial sont court et mémorable.</div>
    <%= f.text_field :title, class: 'repo form-control' %>
    </div>
    <br>
    <div class="form-group">
    <%= f.label :description %>
    <div style="width: 420px;">
      <%= f.trix_editor :description, class: 'repo form-control', style: "height: auto!important;" %>
    </div>
    </div>

    <%= label_tag :file, "Project files<br>Fichiers du Projet".html_safe %>
    <div class="form-group"></div>
    <div class="input-group mb-3">
      <div class="custom-file">
        <%= file_field_tag 'files[]', type: :files, multiple: true, class: 'custom-file-input', aria_label: 'Project Files / Fichiers du projet' %>
        <label class="custom-file-label m-0" for="files_">Choose file</label>
      </div>
    </div>

    <div id="file-container"></div>

    <%= label_tag :photo, "*Gallery/Galerie" %>
    <div>A maximum of five photos can be uploaded per repository.<br>Un maximum de cinq photos peuvent être téléchargés
      par répertoire.
    </div>
    <div class="repo-image">
      <div id="dragndrop">
        <br>
        <%= fa_icon 'cloud-upload' %>
        <p>Drag &amp; Drop</p>
      </div>
      <div class="custom-file">
        <%= file_field_tag 'images[]', type: :files, multiple: true, class: "custom-file-input", aria_label: "Select Pictures / Selectionner des images" %>
        <label class="custom-file-label m-0" for="images_">Choose an image...</label>
      </div>
    </div>

    <div id="image-container"></div>
    <div class="form-group">
    <%= f.label :youtube_link, "Youtube Link" %>
    <div>Your project will be better understood with a 1 min Youtube video.<br>Votre projet sera mieux compris avec une
      vidéo Youtube de 1 minute
    </div>
    <%= f.text_field :youtube_link, class: 'repo form-control' %>
    </div>
    <br>
    <div class="form-group">
    <%= f.label :categories, "*Categories/Catégories" %>

    <div>Choose at most 5 categories that fit your project.<br>Choisi un maximum de 5 catégories qui convent à ton
      projet
    </div>



    <%= f.select :categories, options_from_collection_for_select(CategoryOption.show_options, :id, :name, multiple: true), class: "form-control", include_blank: "Select a category.../Sélectionne une catégorie..." %>
    </div>
    <div id="category-container"></div>

    <br>
    <div class="form-group">
    <%= f.label :equipment, "Equipment/Équipement" %>

    <div>Choose at most 5 pieces of equipment that are related to your project.<br>Choisi un maximum de 5 pièces
      d'équipment qui sont reliés newà ton
    </div>

    <%= f.select :equipments, options_from_collection_for_select(EquipmentOption.show_options, :id, :name, multiple: true), class: "profile-text form-control", include_blank: "Select a piece of equipment.../Sélectionne une piéce d'équipement..." %>
    </div>
    <div id="equipment-container"></div>

    <br>
    <div class="form-group">
    <%= f.label :license, "License/Licence" %>

    <div>Choose how you want your project to be used by others.<br>Choisi comment tu veux que ton projet soit utilisé
      par les autres
    </div>

    <%= f.select :license, @repository.class.license_options, class: "form-control" %>
    </div>

    <div class="form-group">
      <% if params[:project_proposal_id].present? %>
        <%= f.hidden_field :project_proposal_id, value: params[:project_proposal_id] %>
      <% else %>
        <br>
        <%= f.label :license, "Are you creating this project because a Project Proposal? Let us know which Project Proposal. / Êtes-vous en train de créer un projet lié a une proposition de projet ? Veuillez choisir la proposition ci-dessous." %>
        <%= f.select(:project_proposal_id, options_for_select(@project_proposals), {:include_blank => true}, {:class => "form-control"}) %>
      <% end %>
    </div>

    <br>

    <div class="form-group">
      <%= label_tag(:owner, "Add a new owner / Ajouter un autre proprietaire") %>
      <%= select_tag(:owner, "", prompt: "Choose User...", :class => "owner_select form-control", :id => "owner_select", multiple: true) %>
    </div>

    <br>

    <div id="share_option">
      <%= f.label :share_type, "Your project is..." %>
      <%= fa_icon('globe') %>
      <%= f.radio_button(:share_type, "public", :class => "show_extra", :style => "display:inline-flex; vertical-align:middle; margin-right: 4px;", :onclick => "hidePass();", required: true) %><%= f.label('share_type_public', "Public", :id => "type", :style => "display:inline") %>
      <div id="description"> Anyone can see this repository</div>
      <%= fa_icon('lock') %>
      <%= f.radio_button(:share_type, "private", :class => "show_extra", :style => "display:inline-flex; vertical-align:middle; margin-right: 4px;", :onclick => "showPass();") %><%= f.label('share_type_private', "Private / Privé", :id => "type", :style => "display:inline") %>
      <div id="description"> Only those with the url and password can view this repository</div>

      <div id="pass" class="form-group">
        <%= password_field :password, nil, placeholder: 'Password', id: 'password_repo_field', style: "display: none;", 'aria-label': "Password / Mot de Passe", class: "form-control" %>
      </div>

    </div>

    <br>
    <br>
    <%= f.submit "Create Project/Créer ton Projet", class: "btn btn-primary", id: "waiting-save-button" %>
    <span id="status-save"></span>
    <br>
    <div id="form-error-span"></div>

  <% end %>

</section>
<script type="text/javascript" charset="utf-8">
    document.addEventListener("turbolinks:load", function() {
        $("#owner_select").select2({
            theme: "bootstrap",
            placeholder: "Select a user",
            multiple: true,
            allowClear: true,
            ajax: {
                url: "populate_users",
                type: "GET",
                dataType: 'json',
                delay: 250,
                data: function (params) {
                    return {
                        search: params.term
                    };
                },
                processResults: function (data) {
                    return {
                        results: $.map(data.users, function (item) {
                            return {
                                text: item.name,
                                id: item.usernameg
                            }
                        })
                    };
                },
            },
            minimumInputLength: 3,
        });
    });
</script>