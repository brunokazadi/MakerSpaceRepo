<% provide(:title, "Settings") %>

<%= form_for @user, url: user_path(@user.username), method: :patch do |f| %>

  <div class="edit-column">
    <div class="setting-title"><%= t('settings.profile.title') %></div>
    <div class="section-desc">
      <%= t('settings.profile.public_information') %><br/>
      <span><%= t('settings.profile.public_information_desc') %></span>
    </div>


    <div class="form-group">
      <%= f.label :avatar, t('settings.profile.avatar'), class: "profile-label" %>

      <div class="avatar-column">
        <%= image_tag User.display_avatar(@user), class: 'edit-avatar' %>
        <label class="custom-file-upload">
          <%= f.file_field :avatar %>
          <%= t('settings.profile.choose_image') %>
        </label>
      </div>
      <br/>
      <%= link_to t('settings.profile.delete_avatar'), remove_avatar_users_path, class: 'btn btn-danger btn-sm' + (!@user.has_avatar? ? ' disabled' : ''), data: { confirm: t('settings.profile.delete_avatar_confirm') } %>
    </div>

    <div class="form-group">
    <%= f.label :name, t('settings.profile.full_name'), class: "profile-label" %>
    <%= content_tag :span, @user.errors[:name].first, class: 'form-error' %>
    <%= f.text_field :name, class: "profile-text form-control", autofocus: true %>
    </div>

    <% if @user.identity == "undergrad" or @user.identity == "grad" %>
      <div class="form-group">
        <%= f.label :faculty , t('settings.profile.faculty') , class: "profile-label" %>
        <%= content_tag :span, @user.errors[:faculty].first, class: 'form-error' %>
        <%= f.select :faculty, %w(arts civil_law common_law education engineering health_sciences medicine science social_sciences telfer).map{ |faculty| t("settings.profile.#{faculty}") }, { prompt: t('settings.profile.choose') }, { :class => "form-control" } %>
      </div>

      <div class="form-group">
        <%= f.label :program, t('settings.profile.program') , class: "profile-label" %>
        <%= content_tag :span, @user.errors[:program].first, class: 'form-error' %>
        <%= f.select :program, @programs, { prompt: t('settings.profile.choose') }, { :class => "form-control", :id => "options" } %>
      </div>
    <% end %>

    <% unless @user.read_and_accepted_waiver_form %>
      <div class="waiver">
        <hr/>

        <div class="form-group waiver">
          <%= render 'users/waiver' %>
        </div>

        <div class="form-group">
          <div class="custom-control custom-checkbox">
            <%= f.check_box :read_and_accepted_waiver_form, class: 'custom-control-input' %>
            <%= f.label :read_and_accepted_waiver_form, t('users.new.form.accept_waiver_html') + '<span class="required"></span>'.html_safe, class: 'custom-control-label' %>
            <% @user.errors[:read_and_accepted_waiver_form].each do |err| %>
              <%= content_tag :div, err, class: 'invalid-feedback' %>
            <% end %>
          </div>
        </div>

        <hr/>
      </div>
    <% end %>

    <% if @user.identity == "unknown" || @user.name == "anonymous" || @user.gender == "unknown"%>

      <section id="old_users">
        <p id="intro"> <strong>MakerRepo has been updated and the users who've already had an account have to update their information.<br>
           Please fill in the form below and click Save. </strong> </p>

        <%= f.label :name , "Full Name/Nom" , class: "profile-label"%>
        <%= content_tag :span, @user.errors[:name][0], class: 'form-error' %>
        <%= content_tag :span, @user.errors[:name][1], class: 'form-error',
           style: 'display: block;' if @user.errors[:name][1] %>
        <%= f.text_field :name, class: "profile-text", autofocus: true %>

        <%= f.label :gender , class: "profile-label" %>
        <%= content_tag :span, @user.errors[:gender].first, class: 'form-error' %>
        <%= f.select :gender, ["Male", "Female", "Other", "Prefer not to specify"] , prompt: "Choose..." %><br>


        <%= f.label :identity, "I am a ..." , class: "profile-label" %>
        <%= content_tag :span, @user.errors[:identity].first, class: 'form-error' %>
        <%= f.select :identity, ["grad", "undergrad", "faculty_member", "community_member"] , prompt: "Choose..." %><br><br>

        <p> If you are <strong>not</strong> a <strong> student </strong>, you can ignore the rest of the form and click Save. </p>
        <p> If you <strong>are</strong> a student (grad/undergrad) it is mandatory for you to answer the questions below. </p>

        <%= f.label :student_id , "Student Number" , class: "profile-label"%>
        <%= content_tag :span, @user.errors[:student_id].first, class: 'form-error' %>
        <%= f.text_field :student_id, class: "profile-text", autofocus: true %>

        <%= f.label :faculty , "Faculty" , class: "profile-label" %>
        <%= content_tag :span, @user.errors[:faculty].first, class: 'form-error' %>
        <%= f.select :faculty, ["Arts", "Civil Law", "Common Law", "Education", "Engineering", "Health Sciences", "Medicine", "Science", "Social Sciences", "Telfer School of Management"] , prompt: "Choose..." %><br><br>

        <%= f.label :program, "Program" , class: "profile-label" %>
        <%= content_tag :span, @user.errors[:program].first, class: 'form-error' %>
        <%= f.select(:program, @programs , {prompt: "Choose..."} , {:class => "programs", :id => "options"}) %><br><br>

        <%= f.label :year_of_study, "What year are you in?", class: "profile-label"  %>
        <%= content_tag :span, @user.errors[:year_of_study].first, class: 'form-error' %>
        <%= f.select :year_of_study, ["1", "2", "3","4","5"] , prompt: "Select a year ..." %><br><br>
      </section>
    <% end %>

    <%= f.submit t('settings.profile.save'), class: "btn btn-secondary" %>
  </div>
<% end %>
